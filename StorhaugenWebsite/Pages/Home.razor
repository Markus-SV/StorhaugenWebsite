@page "/"
@using StorhaugenWebsite.Models
@using StorhaugenWebsite.Services
@inject IFoodService FoodService

<h1>Food Rater 🍔</h1>

@if (userEmail == null)
{
    <button class="btn btn-primary" @onclick="Login">Log in with Google to Add Food</button>
}
else
{
    <p>Logged in as: <strong>@userEmail</strong></p>

    <div class="card p-3 my-3">
        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <div class="alert alert-danger">@errorMessage</div>
        }

        <input class="form-control mb-2" placeholder="Food Name" @bind="newFood.Name" />
        <input class="form-control mb-2" type="number" placeholder="Rating (1-5)" @bind="newFood.Rating" />
        <button class="btn btn-success" @onclick="AddFood">Add Food</button>
    </div>
}

<h3>Food List</h3>
<ul>
    @foreach (var food in foodList)
    {
        <li>@food.Name - ⭐ @food.Rating</li>
    }
</ul>

@code {
    private string? userEmail;
    private string? errorMessage;
    private FoodItem newFood = new() { Rating = 5 }; // Use the model directly for binding
    private List<FoodItem> foodList = new();

    protected override async Task OnInitializedAsync()
    {
        await LoadFoods();
    }

    private async Task Login()
    {
        userEmail = await FoodService.LoginAsync();
    }

    private async Task AddFood()
    {
        try
        {
            errorMessage = null;
            await FoodService.SubmitFoodReviewAsync(newFood);

            // Reset form
            newFood = new() { Rating = 5 };
            await LoadFoods();
        }
        catch (Exception ex)
        {
            errorMessage = ex.Message;
        }
    }

    private async Task LoadFoods()
    {
        foodList = await FoodService.RetrieveAllFoodsAsync();
    }
}